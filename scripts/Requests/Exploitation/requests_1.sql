-- --------------------------------------------------
-- Sélectionner tous les employés d'un restaurant
-- --------------------------------------------------

SELECT 
    oc_user.title AS "Title", oc_user.lastname AS "Lastname", 
    oc_user.firstname AS "Firstname", oc_role.role AS "Role",
    oc_restaurant.name AS "Restaurant"
FROM 
    oc_employee
INNER JOIN oc_user ON 
    oc_user.user_id = oc_employee.user_id
INNER JOIN oc_role ON 
    oc_role.role_id = oc_employee.role_id
INNER JOIN oc_restaurant ON 
    oc_restaurant.restaurant_id = oc_employee.restaurant_id
WHERE 
    oc_restaurant.restaurant_id = 1
ORDER BY 
    oc_role.role_id;

-- --------------------------------------------------------------------
-- Sélectionner les noms, prénoms, login de tous les comptes Customer
-- --------------------------------------------------------------------

SELECT 
    oc_user.firstname AS "Firstname", oc_user.lastname AS "Lastname",
    oc_user.login AS "Login"
FROM 
    oc_customer
INNER JOIN oc_user ON 
    oc_user.user_id = oc_customer.user_id;

-- ----------------------------------------------------------------------
-- Voir si un client a une commande en livraison et quel est son statut
-- ----------------------------------------------------------------------

SELECT 
    oc_order.order_id AS "# Order", oc_order.delivery AS "Delivery", 
    oc_user.firstname AS "Firstname", oc_user.lastname AS "Lastname", 
    oc_order_state.order_state AS "Order state"
FROM 
    oc_order
INNER JOIN oc_customer ON 
    oc_customer.customer_id = oc_order.customer_id
INNER JOIN oc_user ON 
    oc_user.user_id = oc_customer.user_id
INNER JOIN oc_order_state ON 
    oc_order_state.order_state_id = oc_order.order_state_id
WHERE 
    oc_order.delivery = 1
ORDER BY 
    oc_order_state.order_state_id;

-- -----------------------------------------------------------
-- Sélectionner le stock d'olives dans un restaurant donné
-- -----------------------------------------------------------

SELECT 
    oc_ingredient.name AS "Ingredient", oc_stock.quantity AS "Qty (gr.)", 
    oc_restaurant.name AS "Restaurant"
FROM 
    oc_stock
INNER JOIN oc_ingredient ON 
    oc_ingredient.ingredient_id = oc_stock.ingredient_id
INNER JOIN oc_restaurant ON 
    oc_restaurant.restaurant_id = oc_stock.restaurant_id
WHERE 
    oc_ingredient.name = 'Olive'
AND 
    oc_restaurant.restaurant_id = 5;

-- --------------------------------------
-- Rechercher la recette d'un article
-- --------------------------------------

SELECT 
    oc_pizza.name AS "Pizza", oc_reminder.name AS "Title", 
    oc_reminder.description AS "Recipe"
FROM 
    oc_reminder 
INNER JOIN oc_pizza ON 
    oc_pizza.pizza_id = oc_reminder.pizza_id 
WHERE 
    oc_pizza.name = 'Gourmande';

-- -------------------------------------------------------
-- Rechercher le prix hors taxe d'un article en commande
-- -------------------------------------------------------

SELECT 
    oc_order.order_id AS "# Order", oc_pizza.name AS "Pizza", 
    oc_pizza.unit_price_ht AS "Unit Price HT"
FROM 
    oc_item
INNER JOIN oc_order ON 
    oc_order.order_id = oc_item.order_id
INNER JOIN oc_pizza ON 
    oc_pizza.pizza_id = oc_item.pizza_id
WHERE 
    oc_order.order_id = 68;

-- ---------------------------------------------------------------------------
-- Rechercher l'adresse d'une facture/commande qui n'a pas été payé
-- ---------------------------------------------------------------------------

SELECT 
    oc_order.order_id AS "# Order", oc_user.lastname AS "Lastname",
    oc_user.firstname AS "Firstname", oc_contact.street_number AS "# Street", 
    oc_contact.street_name AS "Street name", oc_contact.postal_code AS "Postal code",
    oc_contact.city AS "City", oc_payment_type.payment_type_id AS "Payment type"
FROM 
    oc_order
INNER JOIN oc_customer ON 
    oc_customer.customer_id = oc_order.customer_id
INNER JOIN oc_user ON 
    oc_user.user_id = oc_customer.user_id
INNER JOIN oc_contact ON 
    oc_contact.contact_id = oc_customer.contact_id
INNER JOIN oc_bill ON 
    oc_bill.order_id = oc_order.order_id
INNER JOIN oc_payment_type ON 
    oc_payment_type.payment_type_id = oc_bill.payment_type_id
WHERE 
    oc_payment_type.payment_type_id = 4 
AND
    oc_order.order_id = 19;

-- -------------------------------------------------------------------------
-- Rechercher l'adresse de livraison d'une commande en cours de livraison
-- -------------------------------------------------------------------------

SELECT 
    oc_order.order_id AS "# Order", oc_contact.street_number AS "# Street", 
    oc_contact.street_name AS "Street name", oc_contact.postal_code AS "Postal code", 
    oc_contact.city "City", oc_order_state.order_state AS "Order state"
FROM 
    oc_order
INNER JOIN oc_customer ON 
    oc_customer.customer_id = oc_order.customer_id
INNER JOIN oc_contact ON 
    oc_contact.contact_id = oc_customer.contact_id
INNER JOIN oc_order_state ON 
    oc_order_state.order_state_id = oc_order.order_state_id
WHERE 
    oc_order.delivery = 1 
AND 
    oc_order_state.order_state_id = 4;

-- --------------------------------------------------------------
-- Retrouver l'intitulé de profession d'un membre du personnel
-- --------------------------------------------------------------
    
    -- Par le login

SELECT 
    oc_user.lastname AS "Lastname", oc_user.firstname AS "Firstname", 
    oc_role.role AS "Role"
FROM 
    oc_employee
INNER JOIN oc_user ON 
    oc_user.user_id = oc_employee.user_id
INNER JOIN oc_role ON 
    oc_role.role_id = oc_employee.role_id
WHERE 
    oc_user.login = 'ryglou';

    -- Par le nom et prénom

SELECT 
    oc_user.lastname AS "Lastname", oc_user.firstname AS "Firstname", 
    oc_role.role AS "Role"
FROM 
    oc_employee
INNER JOIN oc_user ON 
    oc_user.user_id = oc_employee.user_id
INNER JOIN oc_role ON 
    oc_role.role_id = oc_employee.role_id
WHERE 
    oc_user.lastname = 'Bouzerar' AND
    oc_user.firstname = 'David'


-- --------------------------------------------------------------
-- Rechercher la quantité donnée d'un ingrédient pour une recette
-- --------------------------------------------------------------

SELECT 
    oc_reminder.name AS "Title", oc_reminder.description AS "Recipe", 
    oc_ingredient.name AS "Ingredient", oc_pizza_ingredient.quantity AS "Qty (gr.)"
FROM 
    oc_pizza 
INNER JOIN oc_reminder ON 
    oc_reminder.pizza_id = oc_pizza.pizza_id 
INNER JOIN oc_pizza_ingredient ON 
    oc_pizza_ingredient.pizza_id = oc_pizza.pizza_id 
INNER JOIN oc_ingredient ON 
    oc_ingredient.ingredient_id = oc_pizza_ingredient.ingredient_id  
WHERE 
    oc_pizza.name = 'Royale' 
AND 
    oc_ingredient.name = 'Merguez';